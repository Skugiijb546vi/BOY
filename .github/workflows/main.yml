name: Extract_Audio_From_Telegram_Private
on:
  workflow_dispatch:
    inputs:
      tg_url:
        description: 'Ù„ÛŒÙ†Ú©ÛŒ Ù¾Û†Ø³ØªÛŒ ØªÛÙ„ÛŒÚ¯Ø±Ø§Ù… (Ù†Ù…ÙˆÙˆÙ†Û•: https://t.me/Movie_Timee1/2661)'
        required: true
      audio_name:
        description: 'Ù†Ø§ÙˆÛŒ ÙØ§ÛŒÙ„Û• Ø¯Û•Ù†Ú¯ÛŒÛŒÛ•Ú©Û• Ù„Û• Hugging Face (Ø¨Û• .mp3 Ú©Û†ØªØ§ÛŒÛŒ Ø¨ÛØª)'
        required: true
        default: 'movie_audio.mp3'

jobs:
  extract_and_upload:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ—ï¸ Setup Tools
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y ffmpeg -qq
          python -m pip install -U pip pyrogram tgcrypto huggingface_hub

      - name: â¬‡ï¸ Download Video via Pyrogram
        env:
          TG_API_ID: ${{ secrets.TG_API_ID }}
          TG_API_HASH: ${{ secrets.TG_API_HASH }}
          TG_SESSION: ${{ secrets.TG_SESSION }}
          TG_URL: ${{ github.event.inputs.tg_url }}
        run: |
          python3 -c "
          import os, sys
          from pyrogram import Client
          
          api_id = os.environ.get('TG_API_ID')
          api_hash = os.environ.get('TG_API_HASH')
          # Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ú©Û†Ø¯Û•Ú©Û• Ù„Û• Ù‡Û•Ø± Ø¨Û†Ø´Ø§ÛŒÛŒ Ùˆ Ø¦ÛŒÙ†ØªÛ•Ø±ÛÚ©ÛŒ Ø²ÛŒØ§Ø¯Û•
          session_string = os.environ.get('TG_SESSION', '').strip()
          url = os.environ.get('TG_URL')
          
          if not all([api_id, api_hash, session_string]):
              print('âŒ Ù‡Û•ÚµÛ•: Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ ØªÛÙ„ÛŒÚ¯Ø±Ø§Ù… Ù„Û• Secrets Ù†Û•Ø¯Û†Ø²Ø±Ø§Ù†Û•ÙˆÛ•!')
              sys.exit(1)
              
          parts = url.rstrip('/').split('/')
          if 'c' in parts:
              chat_id = int('-100' + parts[-2])
          else:
              chat_id = parts[-2]
          msg_id = int(parts[-1].split('?')[0])
          
          app = Client('my_account', api_id=int(api_id), api_hash=api_hash, session_string=session_string)
          
          async def main():
              async with app:
                  print(f'ğŸ” Ø¯Û•Ú¯Û•Ú•ÛÙ… Ø¨Û•Ø¯ÙˆØ§ÛŒ Ù†Ø§Ù…Û•ÛŒ Ú˜Ù…Ø§Ø±Û• {msg_id} Ù„Û• {chat_id}...')
                  msg = await app.get_messages(chat_id, msg_id)
                  
                  # Ú¯Û•Ú•Ø§Ù† Ø¨Û•Ø¯ÙˆØ§ÛŒ Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• Ø¦Û•Ú¯Û•Ø± Ù„ÛŒÙ†Ú©Û•Ú©Û• ØªÛ•Ù†Ù‡Ø§ Ù†ÙˆØ³ÛŒÙ† Ø¨ÛØª
                  if not msg or not msg.media:
                      print('âš ï¸ Ø¦Û•Ù… Ù„ÛŒÙ†Ú©Û•ÛŒ Ø¯Ø§ÙˆØªÛ• ØªÛ•Ù†Ù‡Ø§ Ù†ÙˆØ³ÛŒÙ†Û• ÛŒØ§Ù† Ø¨Û•ØªØ§ÚµÛ•! Ø®Û†Ù… Ø¯Û•Ú¯Û•Ú•ÛÙ… Ø¨Û•Ø¯ÙˆØ§ÛŒ Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• Ù„Û• Ù†Ø§Ù…Û•Ú©Ø§Ù†ÛŒ Ù¾ÛØ´ØªØ± Ùˆ Ø¯ÙˆØ§ØªØ±...')
                      msg_prev = await app.get_messages(chat_id, msg_id - 1)
                      msg_next = await app.get_messages(chat_id, msg_id + 1)
                      
                      if msg_prev and msg_prev.media:
                          msg = msg_prev
                          print(f'âœ… Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• Ù„Û• Ù†Ø§Ù…Û•ÛŒ Ù¾ÛØ´ØªØ± (Ú˜Ù…Ø§Ø±Û• {msg_id - 1}) Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•!')
                      elif msg_next and msg_next.media:
                          msg = msg_next
                          print(f'âœ… Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• Ù„Û• Ù†Ø§Ù…Û•ÛŒ Ø¯ÙˆØ§ØªØ± (Ú˜Ù…Ø§Ø±Û• {msg_id + 1}) Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•!')
                      else:
                          print('âŒ Ù‡ÛŒÚ† Ú¤ÛŒØ¯ÛŒÛ†ÛŒÛ•Ú© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•! ØªÚ©Ø§ÛŒÛ• Ú•Ø§Ø³ØªÛ•ÙˆØ®Û† Ú©Ù„ÛŒÚ© Ù„Û•Ø³Û•Ø± Ø®ÙˆØ¯ÛŒ Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• Ø¨Ú©Û• Ùˆ Ù„ÛŒÙ†Ú©Û•Ú©Û•ÛŒ Ú©Û†Ù¾ÛŒ Ø¨Ú©Û•.')
                          sys.exit(1)
                          
                  print('ğŸ“¥ Ø®Û•Ø±ÛŒÚ©ÛŒ Ø¯Ø§Ú¯Ø±ØªÙ†ÛŒ Ú¤ÛŒØ¯ÛŒÛ†Ú©Û•ÛŒÛ• (Ø¦Û•Ù…Û• Ú†Û•Ù†Ø¯ Ø®ÙˆÙ„Û•Ú©ÛÚ© Ø¯Û•Ø®Ø§ÛŒÛ•Ù†ÛØª)...')
                  # Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• Ú•Ø§Ø³ØªÛ•ÙˆØ®Û† Ù„Û•Ù†Ø§Ùˆ ÙÛ†ÚµØ¯Û•Ø±ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ Ù¾Ú•Û†Ú˜Û•Ú©Û• Ø³Û•ÛŒÚ¤ Ø¯Û•Ú©Ø±ÛØª
                  await app.download_media(msg, file_name='./video.mp4')
                  print('âœ… Ú¤ÛŒØ¯ÛŒÛ†Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø¯Ø§Ú¯ÛŒØ±Ø§.')
          
          app.run(main())
          "

      - name: ğŸµ Extract Audio & Delete Video
        run: |
          echo "Ø®Û•Ø±ÛŒÚ©ÛŒ Ø¬ÛŒØ§Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø¯Û•Ù†Ú¯Û•Ú©Û•ÛŒÛ• Ù„Û• Ú•ÛÚ¯Û•ÛŒ FFmpeg..."
          # Ø¯Û•Ø±Ù‡ÛÙ†Ø§Ù†ÛŒ Ø¯Û•Ù†Ú¯Û•Ú©Û• Ù„Û•Ùˆ Ú¤ÛŒØ¯ÛŒÛ†ÛŒÛ•ÛŒ Ú©Û• ØªØ§Ø²Û• Ø¯Ø§Ú¯ÛŒØ±Ø§ÙˆÛ•
          ffmpeg -i "./video.mp4" -q:a 0 -map a "${{ github.event.inputs.audio_name }}"
          echo "âœ… Ø¯Û•Ù†Ú¯Û•Ú©Û• Ø¬ÛŒØ§Ú©Ø±Ø§ÛŒÛ•ÙˆÛ•."
          echo "ğŸ—‘ï¸ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ú¤ÛŒØ¯ÛŒÛ† Ú¯Û•ÙˆØ±Û•Ú©Û• Ø¨Û† Ø¨Û•ØªØ§ÚµÚ©Ø±Ø¯Ù†ÛŒ Ø´ÙˆÛÙ†..."
          rm -f "./video.mp4"

      - name: ğŸš€ Upload Audio to Hugging Face
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python3 -c "
          import os, sys
          from huggingface_hub import HfApi
          
          token = os.getenv('HF_TOKEN')
          audio_file = '${{ github.event.inputs.audio_name }}'
          
          if not os.path.exists(audio_file):
              print('âŒ Ù‡Û•ÚµÛ•: ÙØ§ÛŒÙ„Û• Ø¯Û•Ù†Ú¯ÛŒÛŒÛ•Ú©Û• Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•!')
              sys.exit(1)
              
          api = HfApi()
          # Ù†Ø§Ø±Ø¯Ù† Ø¨Û† Ù†Ø§Ùˆ Ú•ÛŒÙ¾Û†ÛŒ Ø¯ÛŒØ§Ø±ÛŒÚ©Ø±Ø§Ùˆ
          repo_id = 'Sarkoakram/sarko761'
          
          print(f'ğŸ“¤ Ù†Ø§Ø±Ø¯Ù†ÛŒ ÙØ§ÛŒÙ„ Ø¨Û† Hugging Face: {audio_file}...')
          api.upload_file(
              path_or_fileobj=audio_file,
              path_in_repo=audio_file,
              repo_id=repo_id,
              repo_type='dataset',
              token=token
          )
          print('âœ… Ø³Û•Ø¯ Ù„Û• Ø³Û•Ø¯ Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ Ø¨ÙˆÙˆ!')
          "
